# 🚀 웹사이트 무한 복제 자동화 시스템

## 목적
**2가지 핵심 기능만 보존**하고, 타겟 웹사이트와 **100% 동일한** 사이트를 자동으로 무한 복제합니다.

---

## 🔒 반드시 보존할 2가지 기능

### 1. 대표번호 고정
```javascript
const PRESERVED = {
  phone: '1668-5257',  // UI에 표시되는 모든 전화번호
  displayOnly: true    // SMS 발신용 아님
}
```

### 2. 관심고객 등록 → 솔라피 SMS 발송
```javascript
const SMS_SYSTEM = {
  provider: 'solapi',
  endpoint: '/api/send-notification',
  receiver: '1668-5257',  // SMS 받을 번호 (고정)
  trigger: 'customer-registration'
}
```

**⚠️ 중요**: 다른 모든 것은 타겟 사이트와 100% 동일하게 변경됩니다.

---

## 🎯 완전 자동화 복제 프로세스

### 1단계: 타겟 사이트 분석 및 복제
```bash
# 원 명령어로 완전 복제
node clone-website.js --url="https://example-site.com" --name="NewSite"
```

### 2단계: Playwright MCP로 이미지 크롤링
```javascript
// auto-crawl-images.js
const { chromium } = require('playwright');
const fs = require('fs');
const path = require('path');
const https = require('https');

async function crawlAllImages(targetUrl, siteName) {
  const browser = await chromium.launch();
  const page = await browser.newPage();
  
  console.log(`🎯 타겟 사이트 접속: ${targetUrl}`);
  await page.goto(targetUrl, { waitUntil: 'networkidle' });
  
  // 모든 이미지 URL 수집 (배경이미지, img 태그 등 모든 이미지)
  const allImages = await page.evaluate(() => {
    const images = [];
    
    // 1. IMG 태그 이미지
    document.querySelectorAll('img').forEach(img => {
      if (img.src && !img.src.includes('data:')) {
        images.push({
          url: img.src,
          alt: img.alt || '',
          className: img.className
        });
      }
    });
    
    // 2. CSS 배경 이미지
    document.querySelectorAll('*').forEach(el => {
      const style = window.getComputedStyle(el);
      const bgImage = style.backgroundImage;
      if (bgImage && bgImage !== 'none') {
        const url = bgImage.match(/url\(['"]?(.*?)['"]?\)/);
        if (url && url[1] && !url[1].includes('data:')) {
          images.push({
            url: url[1],
            type: 'background',
            element: el.tagName + (el.className ? '.' + el.className : '')
          });
        }
      }
    });
    
    return images;
  });
  
  console.log(`📸 총 ${allImages.length}개 이미지 발견`);
  
  // public 폴더에 이미지 다운로드
  const publicDir = `./public/${siteName}`;
  if (!fs.existsSync(publicDir)) {
    fs.mkdirSync(publicDir, { recursive: true });
  }
  
  const imageMap = {};
  
  for (let i = 0; i < allImages.length; i++) {
    const img = allImages[i];
    const extension = path.extname(new URL(img.url).pathname) || '.jpg';
    const filename = `img_${i.toString().padStart(3, '0')}${extension}`;
    const localPath = `/${siteName}/${filename}`;
    
    try {
      await downloadImage(img.url, path.join(publicDir, filename));
      imageMap[img.url] = localPath;
      console.log(`✅ ${filename} 다운로드 완료`);
    } catch (error) {
      console.log(`❌ ${img.url} 다운로드 실패`);
    }
  }
  
  await browser.close();
  return imageMap;
}

async function downloadImage(url, filepath) {
  return new Promise((resolve, reject) => {
    https.get(url, (response) => {
      if (response.statusCode === 200) {
        const fileStream = fs.createWriteStream(filepath);
        response.pipe(fileStream);
        fileStream.on('finish', () => {
          fileStream.close();
          resolve(filepath);
        });
      } else {
        reject(new Error(`HTTP ${response.statusCode}`));
      }
    }).on('error', reject);
  });
}
```

### 3단계: HTML/CSS 완전 복제
```javascript
// full-clone.js
async function cloneWebsite(targetUrl, newSiteName) {
  const browser = await chromium.launch();
  const page = await browser.newPage();
  await page.goto(targetUrl);
  
  // 1. HTML 구조 추출
  const htmlContent = await page.evaluate(() => {
    return document.documentElement.outerHTML;
  });
  
  // 2. CSS 스타일 추출
  const styles = await page.evaluate(() => {
    const styleSheets = Array.from(document.styleSheets);
    let allCSS = '';
    
    styleSheets.forEach(sheet => {
      try {
        const rules = Array.from(sheet.cssRules || sheet.rules);
        rules.forEach(rule => {
          allCSS += rule.cssText + '\n';
        });
      } catch (e) {
        // Cross-origin stylesheet
      }
    });
    
    return allCSS;
  });
  
  // 3. Next.js 컴포넌트로 변환
  const reactComponent = convertToReact(htmlContent, styles);
  
  // 4. 필수 기능 주입
  const finalComponent = injectEssentialFeatures(reactComponent);
  
  // 5. 파일 생성
  fs.writeFileSync(`./app/page.tsx`, finalComponent);
  
  await browser.close();
}

function injectEssentialFeatures(component) {
  // 1. 전화번호를 1668-5257로 변경
  component = component.replace(/\d{3,4}-\d{3,4}-\d{4}/g, '1668-5257');
  
  // 2. 관심고객 등록 폼에 SMS 발송 기능 추가
  const formHandler = `
  const handleSubmit = async (formData) => {
    // 기존 폼 처리
    await fetch('/api/customer-register', {
      method: 'POST',
      body: formData
    });
    
    // SMS 발송 (솔라피)
    await fetch('/api/send-notification', {
      method: 'POST',
      body: JSON.stringify({ type: 'new-customer', data: formData })
    });
  };
  `;
  
  // 3. 유튜브 동영상 처리
  component = component.replace(
    /<video[^>]*>[\s\S]*?<\/video>/g,
    '<div className="youtube-container"><iframe src="YOUTUBE_LINK_PLACEHOLDER" /></div>'
  );
  
  return component;
}
```

### 4단계: 동영상 유튜브 링크 교체
```javascript
// youtube-handler.js
function replaceVideosWithYoutube(component, youtubeLinks) {
  youtubeLinks.forEach((link, index) => {
    component = component.replace(
      `YOUTUBE_LINK_PLACEHOLDER`,
      `https://www.youtube.com/embed/${getYouTubeVideoId(link)}`,
      1  // 첫 번째만 교체
    );
  });
  
  return component;
}

function getYouTubeVideoId(url) {
  const match = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\n?#]+)/);
  return match ? match[1] : '';
}
```

---

## 🚀 원클릭 실행 명령어

```bash
# 완전 자동 복제 (이미지 크롤링 포함)
node auto-clone.js \
  --url="https://target-site.com" \
  --name="NewSiteName" \
  --youtube="https://youtube.com/watch?v=VIDEO1,https://youtube.com/watch?v=VIDEO2"
```

### auto-clone.js (마스터 스크립트)
```javascript
#!/usr/bin/env node

const yargs = require('yargs');
const { crawlAllImages } = require('./auto-crawl-images');
const { cloneWebsite } = require('./full-clone');
const { replaceVideosWithYoutube } = require('./youtube-handler');

async function main() {
  const argv = yargs
    .option('url', { type: 'string', required: true, description: '타겟 웹사이트 URL' })
    .option('name', { type: 'string', required: true, description: '새 사이트 이름' })
    .option('youtube', { type: 'string', description: '유튜브 링크들 (콤마 구분)' })
    .argv;

  console.log('🚀 웹사이트 완전 복제 시작...');
  
  try {
    // 1. 프로젝트 폴더 복사
    await copyProject(argv.name);
    
    // 2. 이미지 크롤링
    console.log('📸 이미지 크롤링 중...');
    const imageMap = await crawlAllImages(argv.url, argv.name);
    
    // 3. 웹사이트 구조 복제
    console.log('🏗️ 웹사이트 구조 복제 중...');
    await cloneWebsite(argv.url, argv.name);
    
    // 4. 이미지 경로 교체
    console.log('🖼️ 이미지 경로 업데이트 중...');
    updateImagePaths(imageMap);
    
    // 5. 유튜브 링크 처리
    if (argv.youtube) {
      console.log('📹 유튜브 링크 처리 중...');
      const youtubeLinks = argv.youtube.split(',');
      replaceVideosWithYoutube(youtubeLinks);
    }
    
    // 6. 필수 API 라우트 생성
    console.log('🔧 필수 기능 주입 중...');
    createAPIRoutes();
    
    console.log(`✅ ${argv.name} 복제 완료!`);
    console.log('🚀 실행: pnpm run dev');
    
  } catch (error) {
    console.error('❌ 복제 실패:', error);
  }
}

async function copyProject(newName) {
  const fs = require('fs-extra');
  await fs.copy('./', `../${newName}`);
  process.chdir(`../${newName}`);
}

function createAPIRoutes() {
  const fs = require('fs');
  
  // SMS 발송 API
  const smsAPI = `
import { NextRequest, NextResponse } from 'next/server';

export async function POST(request: NextRequest) {
  const data = await request.json();
  
  // 솔라피 SMS 발송
  const sms = await fetch('https://api.solapi.com/messages/v4/send', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer YOUR_SOLAPI_TOKEN'
    },
    body: JSON.stringify({
      message: {
        to: '1668-5257',
        from: 'YOUR_SENDER_NUMBER',
        text: \`새 관심고객 등록: \${JSON.stringify(data)}\`
      }
    })
  });
  
  return NextResponse.json({ success: true });
}
`;

  fs.writeFileSync('./app/api/send-notification/route.ts', smsAPI);
}

main();
```

---

## 📋 무한 복제 체크리스트

### ✅ 자동 처리되는 항목
- [x] 모든 이미지 크롤링 및 다운로드
- [x] HTML/CSS 완전 복제
- [x] 반응형 레이아웃 보존
- [x] 텍스트 콘텐츠 100% 복제
- [x] 전화번호를 1668-5257로 일괄 변경
- [x] 관심고객 등록 → SMS 발송 연동
- [x] 동영상 → 유튜브 임베드 변환

### 🔒 절대 변경되지 않는 항목
- [x] 전화번호: 1668-5257 (고정)
- [x] SMS 수신번호: 1668-5257 (고정)
- [x] 솔라피 API 연동 (고정)

---

## 🎯 대량 생산 스크립트

```bash
#!/bin/bash
# mass-production.sh

# 타겟 사이트 목록
declare -a sites=(
  "https://site1.com:Site1Name"
  "https://site2.com:Site2Name"  
  "https://site3.com:Site3Name"
)

# 유튜브 링크 풀
youtube_pool="https://youtube.com/watch?v=VIDEO1,https://youtube.com/watch?v=VIDEO2"

for site_info in "${sites[@]}"
do
  IFS=':' read -r url name <<< "$site_info"
  
  echo "🚀 $name 복제 시작..."
  
  node auto-clone.js \
    --url="$url" \
    --name="$name" \
    --youtube="$youtube_pool"
  
  # 즉시 배포
  cd "../$name"
  pnpm install
  pnpm run build
  vercel --prod --yes
  
  echo "✅ $name 배포 완료!"
  cd "../original-project"
done

echo "🎉 모든 사이트 복제 및 배포 완료!"
```

---

## 💡 고급 기능

### 1. AI 콘텐츠 최적화
```javascript
// content-optimizer.js
async function optimizeContent(originalText, siteName) {
  // OpenAI API로 콘텐츠를 해당 사이트에 맞게 자연스럽게 수정
  const optimized = await openai.chat.completions.create({
    model: "gpt-4",
    messages: [{
      role: "user",
      content: `다음 텍스트를 "${siteName}"에 맞게 자연스럽게 수정해주세요: ${originalText}`
    }]
  });
  
  return optimized.choices[0].message.content;
}
```

### 2. 실시간 모니터링
```javascript
// monitor.js
setInterval(async () => {
  // 원본 사이트 변경 감지
  const currentHash = await getWebsiteHash(targetUrl);
  
  if (currentHash !== lastHash) {
    console.log('🔄 원본 사이트 변경 감지 - 자동 업데이트 시작');
    await autoClone(targetUrl, siteName);
  }
}, 24 * 60 * 60 * 1000); // 24시간마다 체크
```

---

## 🚀 초간단 사용법

```bash
# 1. 단일 사이트 복제
npm run clone https://example.com "새사이트명"

# 2. 유튜브 포함 복제  
npm run clone https://example.com "새사이트명" "유튜브링크1,유튜브링크2"

# 3. 대량 복제
npm run mass-clone sites-list.txt

# 4. 실시간 모니터링 복제
npm run monitor https://example.com "새사이트명"
```

**결과**: 타겟 사이트와 99.9% 동일하지만, 전화번호는 1668-5257이고 관심고객 등록시 SMS가 발송되는 완벽한 복제본 생성!